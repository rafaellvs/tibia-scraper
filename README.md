# tibia-scraper
scrapes data from [TibiaWiki Fandom](https://tibia.fandom.com/wiki/Main_Page) and inserts it into postgres db



## stack
- node
- postgres
- sequelize
- axios
- cheerio
- eslint


### overview
i used `file-generator` script to generate the database model files, which are built with [Sequelize](https://sequelize.org/) structure.
`scraper` is used to scrape data from TibiaWiki pages.
`main` script syncs models with the database and inserts data into it using `scraper`

currently populated with basic info for [Creatures](https://tibia.fandom.com/wiki/List_of_Creatures), [Bosses](https://tibia.fandom.com/wiki/Bosses), [Swords](https://tibia.fandom.com/wiki/Sword_Weapons), [Axes](https://tibia.fandom.com/wiki/Axe_Weapons), [Clubs](https://tibia.fandom.com/wiki/Club_Weapons), [Distance Weapons](https://tibia.fandom.com/wiki/Distance_Weapons), [Ammunitions](https://tibia.fandom.com/wiki/Ammunition), [Rods](https://tibia.fandom.com/wiki/Rods), [Wands](https://tibia.fandom.com/wiki/Wands), [Helmets](https://tibia.fandom.com/wiki/Wands), [Armors](https://tibia.fandom.com/wiki/Armors), [Shields](https://tibia.fandom.com/wiki/Shields), [Spellbooks](https://tibia.fandom.com/wiki/Spellbooks), [Legs](https://tibia.fandom.com/wiki/Legs), [Boots](https://tibia.fandom.com/wiki/Boots), [Amulets and Necklaces](https://tibia.fandom.com/wiki/Amulets_and_Necklaces), [Rings](https://tibia.fandom.com/wiki/Rings) and [Light Sources](https://tibia.fandom.com/wiki/Light_Sources)



### run locally
first, [setup postgres](https://www.digitalocean.com/community/tutorials/how-to-install-and-use-postgresql-on-ubuntu-18-04) on your machine

create a .env root file, containing connection with the database info:
```
DATABASE=yourdbinfo
DATABASE_USER=yourdbinfo
DATABASE_PASSWORD=yourdbinfo
```

run `yarn`

start it by running `yarn sync`


### structure

#### entities
manually coded array of objects in the following structure:
```
{
  name: 'Entity_name',
  url: 'Entity_url',
}
```
`name` is used essentially for model files generator and `url` with `axios` requests for `scraper`



#### file-generator
uses [node's filesystem library](https://nodejs.org/api/fs.html) `fs`

creates `src/models` folder (if it doesnt exist) then proceeds to create model files based on `entities` entries
`code-templates` contains the code skeletons as template strings, on top of which the model files will be generated

to generate files, use `yarn generate:models` command



#### helpers
`utils.js` file has some useful functions to deal with scraping edge cases. Tibia Wiki's pages sometimes differ in html structure, so they mostly format gathered data.



#### models
generated by `file-generator`. Makes the connection to postgres database and contains the table models using Sequelize



#### scraper
uses [axios](https://github.com/axios/axios) to request pages and [cheerio](https://cheerio.js.org/) to scrape through them.
`scrape-attributes` gets the thead of Wiki's content tables. Its used to create models columns and to build each item that gets inserted into the database
`scrape-menu` is, for now, used to help hardcoding `entities`. Later on i plan on generating `entities` file using it.
the main script gets an entity `page` param, scrapes through the Wiki's content table and returns an array of `items`, which are composed of `item` objects built based on content table rows. 



#### main
`src/index.js` syncs models with the database and inserts data using `scraper`
